<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smoke — v_tavolo_reservations</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:0;padding:20px;background:#fafafa;color:#111827}
    pre{white-space:pre-wrap;background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:10px}
    .err{color:#dc2626}
  </style>
</head>
<body>
  <h1>Smoke test</h1>
  <div id="note">Forcing a REST GET now… open DevTools → Network and filter <code>rest/v1</code>.</div>
  <h2>Debug</h2>
  <pre id="dbg">Starting…</pre>

  <script>
  (async () => {
    // INLINE ENV: remove /env.js dependency for this test
    const URL = 'https://xbiymioeyhvlgacfjeqz.supabase.co';
    const KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhiaXltaW9leWh2bGdhY2ZqZXF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MzMzNjAsImV4cCI6MjA3NjEwOTM2MH0.dRSsQqgGwvCILMXXCg7Argiy8rQ2SeupTQIzqs5H7dc';

    const dbg = document.getElementById('dbg');
    const log = (o) => dbg.textContent = JSON.stringify(o, null, 2);

    // Prove script runs
    console.log('SMOKE BOOT', URL);
    // Force a network request you can see
    const path = '/rest/v1/v_tavolo_reservations?select=tavolo_id,user_id,display_name,status,created_at&order=created_at.asc';

    try {
      const res = await fetch(URL + path, { headers: { apikey: KEY, Authorization: `Bearer ${KEY}` } });
      const text = await res.clone().text();
      let body = null;
      try { body = JSON.parse(text); } catch { body = text.slice(0, 200); }

      log({ path, status: res.status, rows: Array.isArray(body) ? body.length : null, sample: Array.isArray(body) ? body.slice(0,3) : body });
    } catch (e) {
      log({ exception: String(e) });
    }
  })();
  </script>
</body>
</html>
