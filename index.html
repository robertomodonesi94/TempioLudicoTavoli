<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tempio Ludico tavoli</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet" />

  <!-- üåü CONFIGURAZIONE APP (modifica con i tuoi valori Supabase) -->
  <script>
    window.env = {
      SUPABASE_URL: "https://ekijcvhrvkpgncfyemwu.supabase.co",   // <-- cambia con Project URL da Supabase
      SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVraWpjdmhydmtwZ25jZnllbXd1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2NDQyMDMsImV4cCI6MjA3MzIyMDIwM30.4zSq2FwHbwT13OcXmNbMI6beFaKq0r6j6pmzqlCV1xk",          // <-- cambia con Anon key da Supabase
      PRIVACY_URL: "/Privacy+Policy.pdf"                         // oppure link pubblico del PDF
    };
  </script>

  <!-- Supabase client -->
  <script type="module" src="https://esm.sh/@supabase/supabase-js@2"></script>

  <style>
    :root{--red:#d61e2b;--red-600:#b31620;--white:#fff;--bg:#fff6f6;--ink:#1a1a1a;--muted:#777}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Nunito,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    header{position:sticky;top:0;background:linear-gradient(90deg,var(--red),#ff4d5a);color:var(--white);padding:14px 16px;z-index:10;box-shadow:0 6px 16px rgba(0,0,0,.12)}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;font-size:20px}
    .heart{width:26px;height:26px;border-radius:8px;background:var(--white);display:grid;place-items:center;color:var(--red);box-shadow:0 2px 6px rgba(0,0,0,.15)}
    main{max-width:980px;margin:24px auto;padding:0 16px 80px}
    .card{background:#fff;border:1px solid #f0d6d8;border-radius:18px;box-shadow:0 8px 24px rgba(214,30,43,.08);padding:16px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .grow{flex:1 1 240px}
    input,select,button,textarea{font-family:inherit;font-size:15px}
    input,select,textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #e7c2c5;background:#fff}
    textarea{min-height:90px}
    button{border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer;transition:.15s transform,.15s opacity}
    .btn{background:var(--red);color:#fff}
    .btn:hover{transform:translateY(-1px);opacity:.95}
    .btn-ghost{background:#fff;color:var(--red);border:1px solid #f0d6d8}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:18px 0}
    .tab{padding:8px 12px;border-radius:999px;border:1px solid #f0d6d8;background:#fff;color:var(--red);font-weight:700;cursor:pointer}
    .tab.active{background:var(--red);color:#fff;border-color:var(--red)}
    .list{display:grid;gap:12px}
    .tile{display:flex;gap:14px;align-items:center;border:1px solid #f0d6d8;padding:12px;border-radius:14px;background:#fff}
    .tile img{width:84px;height:84px;border-radius:12px;object-fit:cover;border:1px solid #eee}
    .muted{color:var(--muted)}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid #f0d6d8;background:#fff;color:#b31620;font-size:12px;font-weight:800}
    .danger{color:#b31620}
    .divider{height:1px;background:#f6dadd;margin:14px 0}
    .footer{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid #f0d6d8;padding:12px 16px;display:flex;justify-content:center}
    .hint{font-size:13px;color:var(--muted)}
    .right{margin-left:auto}
    .hidden{display:none}
    .center{text-align:center}
    .avatar{width:28px;height:28px;border-radius:50%;background:#ffd7da;display:inline-grid;place-items:center;font-weight:800;color:var(--red)}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="heart">üé≤</div>
      <div>Tempio Ludico tavoli</div>
      <div class="right" id="userBadge"></div>
    </div>
  </header>

  <main>
    <!-- Login -->
    <section id="loginCard" class="card">
      <h2>Benvenuto! üëã</h2>
      <p class="muted">Accedi scegliendo un <strong>username univoco</strong> (senza email n√© password).</p>
      <div class="row">
        <input class="grow" id="usernameInput" placeholder="Scegli il tuo username" maxlength="28" />
        <button class="btn" id="btnLogin">Entra</button>
      </div>
      <p class="hint">Se esiste gi√†, scegli un altro nome. Gli admin sono gestiti dal server.</p>
    </section>

    <!-- Tabs -->
    <nav class="tabs hidden" id="tabs">
      <button class="tab active" data-tab="tavoli">Tavoli</button>
      <button class="tab" data-tab="prenotazioni">Prenotazioni</button>
      <button class="tab" data-tab="privacy">Privacy</button>
      <button class="tab hidden" data-tab="utenti" id="tabUtenti">Utenti</button>
    </nav>

    <!-- Tavoli -->
    <section id="page-tavoli" class="hidden">
      <div class="card" id="createTableCard">
        <h3>Crea un tavolo</h3>
        <div class="row">
          <input class="grow" id="tNome" placeholder="Nome" />
          <select id="tCompl">
            <option value="molto semplice">molto semplice</option>
            <option value="semplice">semplice</option>
            <option value="medio" selected>medio</option>
            <option value="complesso">complesso</option>
            <option value="molto complesso">molto complesso</option>
          </select>
          <input type="number" id="tDur" min="15" step="15" value="120" placeholder="Durata (min)" />
        </div>
        <div class="row">
          <input type="date" id="tDate" />
          <input type="time" id="tTime" />
          <input type="number" id="tSeats" min="1" max="12" value="4" placeholder="Posti" />
        </div>
        <div class="row">
          <textarea id="tDesc" placeholder="Descrizione (facoltativa)"></textarea>
        </div>
        <div class="row">
          <button class="btn" id="btnCreateTable">Crea tavolo</button>
        </div>
      </div>

      <div style="height:10px"></div>
      <div class="card">
        <div class="row" style="align-items:center">
          <h3 class="grow">Elenco tavoli</h3>
          <input id="search" placeholder="Cerca per nome‚Ä¶" style="max-width:260px" />
        </div>
        <div id="tablesList" class="list"></div>
      </div>
    </section>

    <!-- Prenotazioni -->
    <section id="page-prenotazioni" class="hidden">
      <div class="card">
        <h3>Le mie prenotazioni</h3>
        <div id="resList" class="list"></div>
      </div>
    </section>

    <!-- Privacy -->
    <section id="page-privacy" class="hidden">
      <div class="card">
        <h3>Privacy Policy</h3>
        <iframe id="privacyFrame" style="width:100%;height:70vh;border:1px solid #f0d6d8;border-radius:12px"></iframe>
      </div>
    </section>

    <!-- Utenti (solo admin) -->
    <section id="page-utenti" class="hidden">
      <div class="card">
        <h3>Gestione utenti</h3>
        <div id="usersList" class="list"></div>
      </div>
    </section>
  </main>

  <div class="footer">
    <span class="hint">Condividi l'app inviando il link: funziona online su Vercel. ‚ù§Ô∏è</span>
  </div>

  <!-- Main logic -->
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'
    const supabase = createClient(window.env.SUPABASE_URL, window.env.SUPABASE_ANON_KEY)

    // (‚Ä¶ tutto lo script con login, CRUD tavoli, prenotazioni, utenti ‚Ä¶)
    // üëâ identico alla versione completa che ti ho dato prima,
    // solo che ora legge da window.env.*
  </script>
</body>
</html>
